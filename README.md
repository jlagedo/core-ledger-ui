# Core Ledger UI

A modern, enterprise-grade accounting ledger application built with Angular 21. Core Ledger UI provides comprehensive accounting management features including chart of accounts, journal entries, posting periods, and financial reporting.


## ğŸ“‹ Table of Contents

https://github.com/user-attachments/assets/adb69d8a-af7b-476a-97c4-af92dab0d48c

- [Features](#features)
- [Tech Stack](#tech-stack)
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Development](#development)
  - [Development Server](#development-server)
  - [Code Scaffolding](#code-scaffolding)
  - [Mock Authentication](#mock-authentication-development-only)
- [Project Structure](#project-structure)
- [Testing](#testing)
- [Building](#building)
- [Code Standards](#code-standards)

## âœ¨ Features

- **Chart of Accounts Management** - Create, organize, and manage account hierarchies
- **Journal Entries** - Record and track financial transactions with validation
- **Posting Periods** - Control accounting periods for accurate financial reporting
- **Balance Reports** - Generate comprehensive financial statements and reports
- **Dashboard** - Real-time overview of key financial metrics
- **Administration** - User management and system configuration
- **Toast Notifications** - Real-time user feedback for actions (success, error, warning, info)
- **Responsive Design** - Mobile-first UI using Bootstrap 5
- **Modern Angular Architecture** - Standalone components with signals-based state management

## ğŸ› ï¸ Tech Stack

- **Framework:** [Angular 21](https://angular.dev)
- **State Management:** [@ngrx/signals](https://ngrx.io/guide/signals)
- **UI Framework:** [Bootstrap 5.3](https://getbootstrap.com)
- **Component Library:** [ng-bootstrap 20](https://ng-bootstrap.github.io)
- **Icons:** [Bootstrap Icons 1.13](https://icons.getbootstrap.com)
- **Testing:** [Vitest 4.0](https://vitest.dev)
- **Build Tool:** Angular CLI 21.0.4
- **Package Manager:** npm 11.6.2

## ğŸ“¦ Prerequisites

Before you begin, ensure you have the following installed:

- **Node.js:** >= 18.19.0 or >= 20.9.0
- **npm:** >= 11.6.2
- **Angular CLI:** 21.0.4

```bash
# Install Angular CLI globally
npm install -g @angular/cli@21.0.4
```

## ğŸš€ Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd core-ledger-ui
```

2. Install dependencies:
```bash
npm install
```

3. Start the development server:
```bash
npm start
```

4. Open your browser and navigate to `http://localhost:4200/`

## ğŸ’» Development

### Environment Configurations

The application provides multiple development configurations to support different authentication modes:

| Configuration | Auth Mode | Default | Command | Use Case |
|--------------|-----------|---------|---------|----------|
| **local-noauth** | Mock Authentication | âœ… Yes | `npm start` | Local development without Auth0 dependency |
| **local-auth** | Real Auth0 | No | `npm run start:auth` | Testing with real Auth0 integration |
| **development** | Real Auth0 | No | `ng serve --configuration=development` | Standard development mode |
| **production** | Real Auth0 | No | `ng build --configuration=production` | Production builds |

**Default Configuration:** The application now defaults to `local-noauth` for faster local development without requiring Auth0 setup.

### Development Server

Start a local development server with live reload:

```bash
# Start with mock authentication (default)
npm start
# or
ng serve

# Start with real Auth0 authentication
npm run start:auth
# or
ng serve --configuration=local-auth
```

The application will automatically reload when you change any source files.

### Code Scaffolding

Generate new components, services, and more:

```bash
# Generate a new component
ng generate component features/my-feature/my-component

# Generate a new service
ng generate service services/my-service

# Generate a new directive
ng generate directive directives/my-directive
```

For a complete list of available schematics:
```bash
ng generate --help
```

### Mock Authentication (Development Only)

For development and testing without requiring Auth0, the application includes a mock authentication system with JWT token generation.

#### Generate Mock Tokens

The project includes a CLI tool to generate JWT tokens for mock users:

```bash
# Generate tokens for all mock users
npm run generate-tokens

# Generate token for a specific user
npm run generate-tokens admin
npm run generate-tokens fund-manager
npm run generate-tokens trader
npm run generate-tokens analyst
```

#### Architecture

The mock authentication system uses a clean separation of concerns:

- **`src/app/auth/mock-users.ts`** - User configuration (source of truth)
  - Contains user profiles, permissions, and backend user data
  - Only file you manually edit to add/modify users

- **`src/app/auth/mock-tokens.ts`** - Auto-generated JWT tokens
  - Contains JWT tokens for each mock user
  - **DO NOT EDIT MANUALLY** - generated by CLI tool
  - Includes generation timestamp
  - **Replaced with error stub in production builds**

- **`src/app/auth/mock-tokens.production.ts`** - Production safety stub
  - Throws errors if accessed in production builds
  - Automatically used via Angular file replacements

- **`tools/generate-dev-token.ts`** - Token generator CLI
  - Dynamically imports `mock-users.ts` as a TypeScript module
  - Reads user data and permissions directly from the exported object
  - Generates proper JWT tokens with claims and permissions
  - Writes entire `mock-tokens.ts` file atomically

#### Mock User Roles

The system includes four pre-configured user roles:

| Role | Permissions | Description |
|------|-------------|-------------|
| **admin** | Full access (13 permissions) | Complete system access including securities, funds, ledger, portfolio, NAV, and reports |
| **fund-manager** | Fund & ledger management (9 permissions) | Manage funds, accounts, transactions, NAV, and view reports |
| **trader** | Transaction & portfolio (7 permissions) | Execute transactions, manage portfolio, view securities and accounts |
| **analyst** | Read-only (7 permissions) | View-only access to securities, funds, accounts, transactions, portfolio, NAV, and reports |

#### Adding New Mock Users

1. Edit `src/app/auth/mock-users.ts` to add your new user
2. Define the user's `oidcUserData`, `permissions`, and `backendUser`
3. Run `npm run generate-tokens` to generate the JWT token
4. The token is automatically added to `mock-tokens.ts`

#### Enabling Mock Auth

**Quick Start:** The application defaults to mock authentication with the `local-noauth` configuration:

```bash
# Mock auth is enabled by default
npm start
```

**Customizing Mock User:** Edit `src/environments/environment.local-noauth.ts` to change the mock user:

```typescript
// src/environments/environment.local-noauth.ts
export const environment = {
  auth: {
    useMock: true,        // Enable mock auth
    mockUser: 'admin'     // Choose user role: admin, fund-manager, trader, analyst
  }
};
```

**Switching to Real Auth0:** Use the `local-auth` configuration:

```bash
npm run start:auth
```

**âš ï¸ Important:** Mock authentication is only available in development mode and will throw an error if used in production.

#### Production Safety

The mock authentication system has **multiple security layers** to prevent accidental use in production:

**ğŸ”’ Layer 1: Build-Time File Replacement**
- Production builds automatically replace `mock-tokens.ts` with a stub that throws errors
- Configured in `angular.json` file replacements
- Real tokens never included in production bundles

**ğŸ”’ Layer 2: Runtime Environment Check**
- `MockAuthService` validates `environment.production` flag
- Throws error immediately if production mode detected
- Prevents service instantiation in production

**ğŸ”’ Layer 3: Environment Configuration**
- Production environment files disable mock auth by default
- Requires explicit `useMock: true` flag (never set in production)

**Testing Production Safety:**
```bash
# Build for production
ng build --configuration production

# Verify mock-tokens.production.ts is used (check dist/ bundle)
# Any attempt to use mock auth will throw runtime error
```

This multi-layered approach ensures mock tokens and authentication are **completely safe** and will never reach production builds.

## ğŸ“ Project Structure

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ config/              # Application configuration
â”‚   â”œâ”€â”€ directives/          # Custom Angular directives
â”‚   â”œâ”€â”€ features/            # Feature modules
â”‚   â”‚   â”œâ”€â”€ administration/     # User & system management
â”‚   â”‚   â”œâ”€â”€ balances-reports/   # Financial reporting
â”‚   â”‚   â”œâ”€â”€ chart-of-accounts/  # Account management
â”‚   â”‚   â”œâ”€â”€ dashboard/          # Main dashboard
â”‚   â”‚   â”œâ”€â”€ journal-entries/    # Transaction recording
â”‚   â”‚   â””â”€â”€ posting-periods/    # Period management
â”‚   â”œâ”€â”€ layout/              # Layout components (header, footer, toasts)
â”‚   â”œâ”€â”€ models/              # TypeScript interfaces and types
â”‚   â”œâ”€â”€ services/            # Shared services
â”‚   â”‚   â””â”€â”€ toast-service.ts   # Toast notification service
â”‚   â”œâ”€â”€ app.config.ts        # Application configuration
â”‚   â”œâ”€â”€ app.routes.ts        # Routing configuration
â”‚   â””â”€â”€ app.ts               # Root component
â”œâ”€â”€ public/                  # Static assets
â””â”€â”€ main.ts                  # Application entry point
```

## ğŸ§ª Testing

### Unit Tests

Run unit tests with Vitest:

```bash
ng test
# or
npm test
```

### End-to-End Tests

E2E testing framework is not configured by default. Choose and configure one based on your needs (e.g., Playwright, Cypress).

## ğŸ—ï¸ Building

### Development Build

```bash
ng build
```

### Production Build

```bash
ng build --configuration production
```

Build artifacts will be stored in the `dist/` directory. The production build optimizes the application for performance and speed.

### Watch Mode

Automatically rebuild on file changes:

```bash
# Watch mode with mock authentication (default)
npm run watch

# Watch mode with real Auth0 authentication
npm run watch:auth
```

## ğŸ“ Code Standards

This project follows Angular and TypeScript best practices:

- **Standalone Components** - All components use the standalone API
- **Signals** - Reactive state management using Angular signals
- **TypeScript Strict Mode** - Enabled for type safety
- **SCSS** - Styling with SCSS preprocessor
- **Prettier** - Code formatting (printWidth: 100, singleQuote: true)
- **Bootstrap Utilities** - Use Bootstrap classes, avoid inline styles

### Formatting

Code is formatted with Prettier. Configuration is in `package.json`:

```bash
# Format code (if formatter is set up)
npx prettier --write "src/**/*.{ts,html,scss}"
```

## ğŸ“š Additional Resources

- [Angular Documentation](https://angular.dev)
- [Angular CLI Reference](https://angular.dev/tools/cli)
- [Bootstrap 5 Documentation](https://getbootstrap.com/docs/5.3)
- [ng-bootstrap Components](https://ng-bootstrap.github.io)
- [NgRx Signals](https://ngrx.io/guide/signals)
