<div [attr.aria-label]="store.isSidenavCollapsed() ? 'Collapsed sidenav' : 'Expanded sidenav'"
     [style.width]="store.isSidenavCollapsed() ? '4rem' : '15rem'"
     [class.sidenav-wrapper--collapsed]="store.isSidenavCollapsed()"
     class="d-flex flex-column flex-shrink-0 transition-all sidenav-wrapper vh-100">

  <!-- Left accent line -->
  <span class="sidenav-accent-line" aria-hidden="true"></span>

  <!-- Header Section (Logo & Toggle) -->
  <div class="d-flex align-items-center header-section"
       [class.justify-content-center]="store.isSidenavCollapsed()"
       [class.justify-content-between]="!store.isSidenavCollapsed()">
    @if (store.isSidenavCollapsed()) {
      <!-- Collapsed: Show hamburger menu icon only -->
      <button (click)="toggleSidenav()"
              aria-expanded="false"
              aria-label="Expand sidenav"
              class="sidenav-toggle">
        <i class="bi bi-list"></i>
      </button>
    } @else {
      <!-- Expanded: Show logo and close button -->
      <a aria-label="Go to dashboard"
         class="sidenav-logo"
         routerLink="/dashboard">
        <i class="bi bi-boxes sidenav-logo__icon"></i>
        <span class="sidenav-logo__text">Core</span>
        <span class="sidenav-status" aria-hidden="true"></span>
      </a>

      <button (click)="toggleSidenav()"
              aria-label="Collapse sidenav"
              class="sidenav-toggle">
        <i class="bi bi-x-lg"></i>
      </button>
    }
  </div>

  <!-- Navigation Menu -->
  <ul class="nav nav-pills flex-column mb-auto sidenav-nav">
    @for (item of menuItems(); track item.label; let i = $index) {
      <!-- Section divider before Ledger -->
      @if (item.label === 'Ledger') {
        <li>
          <div class="sidenav-section"
               [class.sidenav-section--collapsed]="store.isSidenavCollapsed()">
            <span class="sidenav-section__label">
              <span>Ledger</span>
            </span>
          </div>
        </li>
      }

      @if (item.children) {
        <!-- Menu item with submenu -->
        <li class="nav-item">
          <a (click)="store.toggleMenuItem(item.label)"
             [attr.aria-controls]="item.label + 'Submenu'"
             [attr.aria-expanded]="!store.isMenuItemCollapsed(item.label)"
             [class.justify-content-center]="store.isSidenavCollapsed()"
             [ngbTooltip]="store.isSidenavCollapsed() ? item.label : ''"
             class="nav-link nav-link--parent d-flex align-items-center"
             placement="end"
             role="button"
             routerLinkActive="border border-light bg-transparent">
            <i [class.me-2]="!store.isSidenavCollapsed()" class="bi {{ item.icon }}"></i>
            @if (!store.isSidenavCollapsed()) {
              <span class="flex-grow-1">{{ item.label }}</span>
              <i [class.bi-chevron-down]="!store.isMenuItemCollapsed(item.label)"
                 [class.bi-chevron-right]="store.isMenuItemCollapsed(item.label)"
                 class="bi"></i>
            }
          </a>
          <div [attr.id]="item.label + 'Submenu'"
               [ngbCollapse]="store.isSidenavCollapsed() || store.isMenuItemCollapsed(item.label)">
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
              @for (child of item.children; track child.label) {
                <li class="nav-item">
                  <a [ngbTooltip]="store.isSidenavCollapsed() ? child.label : ''"
                     [routerLinkActiveOptions]="child.exactMatch ? { exact: true } : { exact: false }"
                     [routerLink]="child.route"
                     class="nav-link d-flex align-items-center"
                     placement="end"
                     routerLinkActive="active">
                    @if (store.isSidenavCollapsed()) {
                      <span class="submenu-indicator"></span>
                    } @else {
                      <span>{{ child.label }}</span>
                    }
                  </a>
                </li>
              }
            </ul>
          </div>
        </li>
      } @else {
        <!-- Simple menu item without submenu -->
        <li class="nav-item">
          <a [class.justify-content-center]="store.isSidenavCollapsed()"
             [ngbTooltip]="store.isSidenavCollapsed() ? item.label : ''"
             [routerLinkActiveOptions]="item.exactMatch ? { exact: true } : { exact: false }"
             [routerLink]="item.route"
             class="nav-link d-flex align-items-center"
             placement="end"
             routerLinkActive="active">
            <i [class.me-2]="!store.isSidenavCollapsed()" class="bi {{ item.icon }}"></i>
            @if (!store.isSidenavCollapsed()) {
              <span>{{ item.label }}</span>
            }
          </a>
        </li>
      }
    }
  </ul>

  <!-- User Profile Footer -->
  <div class="sidenav-footer">
    <app-user-profile [isCollapsed]="store.isSidenavCollapsed()"/>
  </div>
</div>
