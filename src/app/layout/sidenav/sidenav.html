<div [attr.aria-label]="isSidenavCollapsed() ? 'Collapsed sidenav' : 'Expanded sidenav'"
     [style.width]="isSidenavCollapsed() ? '70px' : '220px'"
     class="d-flex flex-column flex-shrink-0 p-3 transition-all border-end"
     style="height: 100vh;">

  <!-- Logo & Toggle Section -->
  <div [class.justify-content-between]="!isSidenavCollapsed()"
       [class.justify-content-center]="isSidenavCollapsed()" class="d-flex align-items-center mb-3">
    <a (click)="handleLogoClick($event)"
       [attr.aria-label]="isSidenavCollapsed() ? 'Expand sidenav' : 'Go to dashboard'"
       [attr.role]="isSidenavCollapsed() ? 'button' : null"
       [class.cursor-pointer]="isSidenavCollapsed()" [routerLink]="isSidenavCollapsed() ? null : '/dashboard'"
       class="d-flex align-items-center text-white text-decoration-none" tabindex="0">
      <img [class.me-2]="!isSidenavCollapsed()" alt="Fluxo Logo" height="32" src="apple-touch-icon.png"
           width="32">
      @if (!isSidenavCollapsed()) {
        <span class="fs-4 numeric">Core</span>
      }
    </a>
    @if (!isSidenavCollapsed()) {
      <button (click)="toggleSidenav()" [attr.aria-expanded]="true"
              [attr.aria-label]="'Collapse sidenav'" class="btn btn-link text-white p-0 border-0">
        <i class="bi bi-x-lg" style="font-size: 1.5rem;"></i>
      </button>
    }
  </div>
  <hr>
  <!-- Navigation Menu -->
  <ul class="nav nav-pills flex-column mb-auto">
    @for (item of menuItems(); track item.label) {
      @if (item.label === 'Ledger') {
        <li>
          <hr class="my-2 border-secondary">
        </li>
      }

      @if (item.children) {
        <!-- Menu item with submenu -->
        <li>
          <a (click)="toggleMenuItem(item.label)"
             [attr.aria-controls]="item.label + 'Submenu'"
             [attr.aria-expanded]="!isMenuItemCollapsed(item.label)"
             [class.justify-content-center]="isSidenavCollapsed()"
             [ngbTooltip]="isSidenavCollapsed() ? item.label : ''"
             class="nav-link text-white d-flex align-items-center"
             placement="end" role="button"
             routerLinkActive="border border-light bg-transparent">
            <i [class.me-2]="!isSidenavCollapsed()" class="bi {{ item.icon }}"></i>
            @if (!isSidenavCollapsed()) {
              <span class="flex-grow-1">{{ item.label }}</span>
              <i [class.bi-chevron-down]="!isMenuItemCollapsed(item.label)"
                 [class.bi-chevron-right]="isMenuItemCollapsed(item.label)"
                 class="bi"></i>
            }
          </a>
          <div [attr.id]="item.label + 'Submenu'" [ngbCollapse]="isMenuItemCollapsed(item.label)">
            <ul [class.ms-3]="!isSidenavCollapsed()"
                class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
              @for (child of item.children; track child.label) {
                <li>
                  <a [ngbTooltip]="isSidenavCollapsed() ? child.label : ''"
                     [routerLinkActiveOptions]="child.exactMatch ? { exact: true } : { exact: false }"
                     [routerLink]="child.route"
                     class="nav-link text-white d-flex align-items-center"
                     placement="end"
                     routerLinkActive="active">
                    @if (isSidenavCollapsed()) {
                      <span class="submenu-indicator"></span>
                    } @else {
                      <span>{{ child.label }}</span>
                    }
                  </a>
                </li>
              }
            </ul>
          </div>
        </li>
      } @else {
        <!-- Simple menu item without submenu -->
        <li class="nav-item">
          <a [class.justify-content-center]="isSidenavCollapsed()"
             [ngbTooltip]="isSidenavCollapsed() ? item.label : ''"
             [routerLinkActiveOptions]="item.exactMatch ? { exact: true } : { exact: false }"
             [routerLink]="item.route"
             class="nav-link text-white d-flex align-items-center"
             placement="end"
             routerLinkActive="active">
            <i [class.me-2]="!isSidenavCollapsed()" class="bi {{ item.icon }}"></i>
            @if (!isSidenavCollapsed()) {
              <span>{{ item.label }}</span>
            }
          </a>
        </li>
      }
    }
  </ul>

  <!-- User Profile with Theme Toggle -->
  <hr class="border-secondary mt-auto">
  <app-user-profile [isCollapsed]="isSidenavCollapsed()"/>
</div>
