<div [attr.aria-label]="store.isSidenavCollapsed() ? 'Collapsed sidenav' : 'Expanded sidenav'"
     [style.width]="store.isSidenavCollapsed() ? '4rem' : '15rem'"
     class="d-flex flex-column flex-shrink-0 p-1 transition-all border-end sidenav-wrapper vh-100">

  <!-- Logo & Toggle Section -->
  <div class="d-flex align-items-center header-section"
       [class.justify-content-center]="store.isSidenavCollapsed()"
       [class.justify-content-between]="!store.isSidenavCollapsed()">
    @if (store.isSidenavCollapsed()) {
      <!-- Collapsed: Show hamburger menu icon only -->
      <button (click)="toggleSidenav()" aria-expanded="false" aria-label="Expand sidenav"
              class="btn p-0 border-0 bg-transparent">
        <i class="bi bi-list fs-2"></i>
      </button>
    } @else {
      <!-- Expanded: Show logo and close button -->
      <a aria-label="Go to dashboard" class="d-flex align-items-center text-decoration-none"
         routerLink="/dashboard">
        <i class="bi bi-boxes me-2 fs-4 text-primary"></i>
        <span class="fs-4 numeric font-monospace">Core</span>
      </a>

      <i (click)="toggleSidenav()" (keydown.enter)="toggleSidenav()"
         aria-label="Collapse sidenav" class="bi bi-x-lg cursor-pointer"
         role="button" tabindex="0"></i>
    }
  </div>
  <hr>
  <!-- Navigation Menu -->
  <ul class="nav nav-pills flex-column mb-auto">
    @for (item of menuItems(); track item.label) {
      @if (item.label === 'Ledger') {
        <li>
          <hr class="my-2 border-secondary">
        </li>
      }

      @if (item.children) {
        <!-- Menu item with submenu -->
        <li>
          <a (click)="store.toggleMenuItem(item.label)" [attr.aria-controls]="item.label + 'Submenu'"
             [attr.aria-expanded]="!store.isMenuItemCollapsed(item.label)"
             [class.justify-content-center]="store.isSidenavCollapsed()"
             [ngbTooltip]="store.isSidenavCollapsed() ? item.label : ''"
             class="nav-link d-flex align-items-center" placement="end" role="button"
             routerLinkActive="border border-light bg-transparent">
            <i [class.me-2]="!store.isSidenavCollapsed()" class="bi {{ item.icon }}"></i>
            @if (!store.isSidenavCollapsed()) {
              <span class="flex-grow-1">{{ item.label }}</span>
              <i [class.bi-chevron-down]="!store.isMenuItemCollapsed(item.label)"
                 [class.bi-chevron-right]="store.isMenuItemCollapsed(item.label)" class="bi"></i>
            }
          </a>
          <div [attr.id]="item.label + 'Submenu'"
               [ngbCollapse]="store.isSidenavCollapsed() || store.isMenuItemCollapsed(item.label)">
            <ul [class.ms-3]="!store.isSidenavCollapsed()" class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
              @for (child of item.children; track child.label) {
                <li>
                  <a [ngbTooltip]="store.isSidenavCollapsed() ? child.label : ''"
                     [routerLinkActiveOptions]="child.exactMatch ? { exact: true } : { exact: false }"
                     [routerLink]="child.route" class="nav-link d-flex align-items-center" placement="end"
                     routerLinkActive="active">
                    @if (store.isSidenavCollapsed()) {
                      <span class="submenu-indicator"></span>
                    } @else {
                      <span>{{ child.label }}</span>
                    }
                  </a>
                </li>
              }
            </ul>
          </div>
        </li>
      } @else {
        <!-- Simple menu item without submenu -->
        <li class="nav-item">
          <a [class.justify-content-center]="store.isSidenavCollapsed()"
             [ngbTooltip]="store.isSidenavCollapsed() ? item.label : ''"
             [routerLinkActiveOptions]="item.exactMatch ? { exact: true } : { exact: false }" [routerLink]="item.route"
             class="nav-link d-flex align-items-center" placement="end" routerLinkActive="active">
            <i [class.me-2]="!store.isSidenavCollapsed()" class="bi {{ item.icon }}"></i>
            @if (!store.isSidenavCollapsed()) {
              <span>{{ item.label }}</span>
            }
          </a>
        </li>
      }
    }
  </ul>

  <!-- User Profile with Theme Toggle -->
  <hr class="border-secondary mt-auto">
  <app-user-profile [isCollapsed]="store.isSidenavCollapsed()"/>
</div>
