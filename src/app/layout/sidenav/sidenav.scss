// ============================================================
// SIDENAV â€” Bloomberg Terminal Navigation Panel
//
// A sophisticated navigation system with the signature
// Bloomberg terminal aesthetic: amber accents, grid overlays,
// and subtle glow effects.
// ============================================================

@use "sass:color";

// ============================================================
// ANIMATIONS
// ============================================================

@keyframes sidenav-glow {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}

@keyframes nav-item-enter {
  from {
    opacity: 0;
    transform: translateX(-8px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes status-pulse {
  0%, 100% {
    opacity: 1;
    box-shadow: 0 0 8px var(--terminal-glow);
  }
  50% {
    opacity: 0.6;
    box-shadow: 0 0 4px var(--terminal-glow);
  }
}

@keyframes chevron-rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(90deg); }
}

// ============================================================
// HOST
// ============================================================

:host {
  display: contents;
}

// ============================================================
// SIDENAV WRAPPER
// ============================================================

.sidenav-wrapper {
  --terminal-glow: var(--accent-amber, #FFA028);
  --grid-line: var(--bs-border-color);

  position: relative;
  background-color: var(--sidenav-bg);
  color: var(--sidenav-color);
  border-color: var(--sidenav-border-color) !important;
  overflow: hidden;

  // Gradient background
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: var(--sidenav-gradient);
    pointer-events: none;
    z-index: 0;
  }

  // Grid pattern overlay (subtle terminal texture)
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(90deg, var(--grid-line) 1px, transparent 1px),
      linear-gradient(var(--grid-line) 1px, transparent 1px);
    background-size: 32px 32px;
    opacity: 0.03;
    pointer-events: none;
    z-index: 0;
  }

  // Left accent line (terminal edge glow)
  .sidenav-accent-line {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(
      180deg,
      var(--terminal-glow) 0%,
      transparent 20%,
      transparent 80%,
      var(--terminal-glow) 100%
    );
    opacity: 0.5;
    z-index: 2;
  }

  // Ensure content appears above overlays
  > * {
    position: relative;
    z-index: 1;
  }

  // Navigation links base
  .nav-link,
  .btn-link,
  a,
  span {
    color: inherit;
    border-color: var(--sidenav-border-color);
  }

  hr {
    border-color: var(--sidenav-divider);
    opacity: 0.5;
    margin: 0.5rem 0;
  }
}

// ============================================================
// WIDTH TRANSITION
// ============================================================

.transition-all {
  transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow-x: hidden;
}

// ============================================================
// HEADER SECTION (Logo & Toggle)
// Aligned with page-header total height (breadcrumb + main row)
// ============================================================

.header-section {
  // Uses shared --header-height CSS variable for perfect alignment
  // with the page-header component (breadcrumb + title rows)
  padding: 1rem;
  border-bottom: 1px solid var(--sidenav-divider);
  height: var(--header-height, 67px);
  box-sizing: border-box;
  position: relative;
  display: flex;
  align-items: center;

  // Logo styling
  .sidenav-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: inherit;

    &:hover {
      .sidenav-logo__icon {
        color: var(--terminal-glow);
        text-shadow: 0 0 12px var(--terminal-glow);
      }
    }
  }

  .sidenav-logo__icon {
    font-size: 1.25rem;
    color: var(--terminal-glow);
    transition: all 0.3s ease;
  }

  .sidenav-logo__text {
    font-size: 1.125rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    color: var(--bs-emphasis-color);
  }

  // Status indicator (pulsing dot)
  .sidenav-status {
    width: 6px;
    height: 6px;
    background: var(--terminal-glow);
    border-radius: 1px;
    animation: status-pulse 2s ease-in-out infinite;
    flex-shrink: 0;
  }

  // Toggle button
  .sidenav-toggle {
    background: transparent;
    border: none;
    color: var(--sidenav-color);
    padding: 0.25rem;
    border-radius: 2px;
    transition: all 0.2s ease;
    cursor: pointer;

    &:hover {
      background: var(--sidenav-link-hover-bg);
      color: var(--terminal-glow);
    }

    &:focus-visible {
      outline: 2px solid var(--terminal-glow);
      outline-offset: 2px;
    }

    i {
      font-size: 1.25rem;
      transition: transform 0.2s ease;
    }
  }
}

// ============================================================
// SECTION LABELS
// ============================================================

.sidenav-section {
  padding: 0.75rem 1rem 0.375rem;

  &__label {
    font-size: 0.5625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--terminal-glow);
    opacity: 0.7;
    display: flex;
    align-items: center;
    gap: 0.5rem;

    &::after {
      content: '';
      flex: 1;
      height: 1px;
      background: linear-gradient(
        90deg,
        var(--sidenav-divider) 0%,
        transparent 100%
      );
    }
  }

  // Hide label when collapsed
  &--collapsed {
    padding: 0.5rem 0;

    .sidenav-section__label {
      justify-content: center;

      span {
        display: none;
      }

      &::after {
        display: none;
      }

      &::before {
        content: '';
        width: 16px;
        height: 1px;
        background: var(--sidenav-divider);
      }
    }
  }
}

// ============================================================
// SCROLLABLE NAVIGATION CONTAINER
// ============================================================

.sidenav-scroll-container {
  overflow-x: hidden;
  overflow-y: auto;
  min-height: 0; // Critical for flex item scrolling

  // Reserve scrollbar space to prevent layout shift when content overflows
  scrollbar-gutter: stable;

  // Custom scrollbar styling (Bloomberg terminal aesthetic)
  &::-webkit-scrollbar {
    width: 4px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background: var(--sidenav-divider);
    border-radius: 2px;

    &:hover {
      background: rgba(255, 160, 40, 0.4);
    }
  }

  // Firefox scrollbar
  scrollbar-width: thin;
  scrollbar-color: var(--sidenav-divider) transparent;

  // Fade effect at top/bottom edges (indicates scrollable content)
  mask-image: linear-gradient(
    to bottom,
    transparent 0,
    black 8px,
    black calc(100% - 8px),
    transparent 100%
  );
  -webkit-mask-image: linear-gradient(
    to bottom,
    transparent 0,
    black 8px,
    black calc(100% - 8px),
    transparent 100%
  );
}

// ============================================================
// NAVIGATION MENU
// ============================================================

.sidenav-nav {
  padding: 0.25rem 0;
  margin-bottom: 0; // Remove mb-auto since scroll container handles spacing
}

// ============================================================
// NAVIGATION ITEMS
// ============================================================

.nav-item {
  margin: 1px 0;
}

.nav-link {
  white-space: nowrap;
  font-size: 0.75rem;
  font-weight: 500;
  padding: 0.5rem 1rem;
  border-radius: 0;
  border-left: 2px solid transparent;
  transition: all 0.2s ease;
  position: relative;

  // Icon styling
  i.bi {
    font-size: 0.875rem;
    transition: all 0.2s ease;
    opacity: 0.85;
  }

  // Hover state
  &:hover {
    background-color: var(--sidenav-link-hover-bg);
    border-left-color: rgba(255, 160, 40, 0.3);

    i.bi {
      opacity: 1;
      color: var(--terminal-glow);
    }
  }

  // Active state
  &.active {
    background-color: var(--sidenav-active-bg);
    border-left-color: var(--sidenav-active-border);
    color: var(--bs-emphasis-color);

    i.bi {
      opacity: 1;
      color: var(--terminal-glow);
      text-shadow: 0 0 8px var(--terminal-glow);
    }

    // Subtle glow effect
    &::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--terminal-glow);
      box-shadow: 0 0 8px var(--terminal-glow);
      opacity: 0.8;
    }
  }

  // Parent item (with children) styling
  &.nav-link--parent {
    text-transform: uppercase;
    letter-spacing: 0.03em;
    font-size: 0.6875rem;
  }

  // Chevron icon rotation
  .bi-chevron-right,
  .bi-chevron-down {
    font-size: 0.625rem;
    opacity: 0.6;
    transition: transform 0.25s ease, opacity 0.2s ease;
  }

  .bi-chevron-down {
    transform: rotate(0deg);
  }

  .bi-chevron-right {
    transform: rotate(-90deg);
  }

  &:hover .bi-chevron-right,
  &:hover .bi-chevron-down {
    opacity: 1;
  }
}

// ============================================================
// SUBMENU
// ============================================================

.btn-toggle-nav {
  padding-left: 0;
  margin-top: 2px;
  border-left: 1px solid var(--sidenav-divider);
  margin-left: 1.5rem;

  .nav-link {
    font-size: 0.6875rem;
    font-weight: 400;
    padding: 0.375rem 0.75rem;
    text-transform: none;
    letter-spacing: 0;
    border-left: none;

    &:hover {
      border-left: none;
      padding-left: 0.875rem;
    }

    &.active {
      border-left: none;

      &::before {
        display: none;
      }

      // Indicator dot for active submenu item
      &::after {
        content: '';
        position: absolute;
        left: -0.75rem;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 4px;
        background: var(--terminal-glow);
        border-radius: 1px;
        box-shadow: 0 0 6px var(--terminal-glow);
      }
    }
  }
}

// ============================================================
// SUBMENU INDICATOR (Collapsed State)
// ============================================================

.submenu-indicator {
  width: 4px;
  height: 4px;
  border-radius: 1px;
  display: inline-block;
  background: var(--sidenav-divider);
  transition: all 0.2s ease;
}

.nav-link:hover .submenu-indicator {
  background: var(--terminal-glow);
  box-shadow: 0 0 6px var(--terminal-glow);
}

.nav-link.active .submenu-indicator {
  background: var(--terminal-glow);
  box-shadow: 0 0 8px var(--terminal-glow);
}

// ============================================================
// COLLAPSED STATE OVERRIDES
// ============================================================

.sidenav-wrapper--collapsed {
  .nav-link {
    justify-content: center;
    padding: 0.625rem;
    border-left-width: 0;

    i.bi {
      font-size: 1rem;
    }

    &:hover {
      border-left-width: 0;

      i.bi {
        transform: scale(1.1);
        text-shadow: 0 0 8px var(--terminal-glow);
      }
    }

    &.active {
      &::before {
        width: 2px;
        left: 0;
      }
    }
  }

  .btn-toggle-nav {
    margin-left: 0;
    border-left: none;

    .nav-link {
      padding: 0.5rem;
    }
  }
}

// ============================================================
// DIVIDER
// ============================================================

.sidenav-divider {
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent 0%,
    var(--sidenav-divider) 20%,
    var(--sidenav-divider) 80%,
    transparent 100%
  );
  margin: 0.5rem 0.75rem;
  border: none;
}

// ============================================================
// FOOTER / USER SECTION
// ============================================================

.sidenav-footer {
  margin-top: auto;
  border-top: 1px solid var(--sidenav-divider);
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 20%;
    right: 20%;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 160, 40, 0.3),
      transparent
    );
  }
}

// ============================================================
// BUTTON STYLING
// ============================================================

.btn-link {
  transition: all 0.2s ease-in-out;
  text-decoration: none;

  &:hover {
    border-radius: 2px;
  }

  &:focus {
    border-radius: 2px;
  }
}

.sidenav-wrapper button {
  color: inherit;

  i {
    color: inherit;
  }
}

// ============================================================
// CURSOR
// ============================================================

.cursor-pointer {
  cursor: pointer;
}

// ============================================================
// DARK MODE ENHANCEMENTS
// ============================================================

[data-bs-theme="dark"] {
  .sidenav-wrapper {
    background: rgba(0, 0, 0, 0.98);

    &::after {
      opacity: 0.04;
    }
  }

  .sidenav-accent-line {
    opacity: 0.7;
  }

  .sidenav-logo__icon {
    text-shadow: 0 0 8px var(--terminal-glow);
  }

  .nav-link.active {
    background-color: rgba(255, 160, 40, 0.12);
  }
}

// ============================================================
// LIGHT MODE ADJUSTMENTS
// ============================================================

[data-bs-theme="light"] {
  .sidenav-wrapper {
    --terminal-glow: #B45309;

    &::after {
      opacity: 0.02;
    }
  }

  .sidenav-accent-line {
    opacity: 0.4;
  }

  .sidenav-section__label {
    color: #B45309;
  }

  .nav-link.active {
    i.bi {
      text-shadow: none;
    }

    &::before {
      box-shadow: none;
    }
  }
}
