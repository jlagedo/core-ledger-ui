// Transaction List — Bloomberg Terminal Grid Styling
// Refined AG Grid integration with application theme

:host {
  display: block;
  // Account for fixed bulk action bar
  padding-bottom: 0;
  transition: padding-bottom 0.25s ease-out;

  &:has(.bulk-action-bar) {
    padding-bottom: 4.5rem;
  }
}

// Grid container styling
ag-grid-angular {
  display: block;
  border-radius: 0 0 0.125rem 0.125rem; // Match app's micro radius

  // Smooth theme transitions
  transition: background-color 0.2s ease-in-out;
}

// Action button refinements
:host ::ng-deep {
  // Edit button in Actions column
  .btn-outline-primary {
    font-size: 0.6875rem;
    font-weight: 500;
    padding: 0.1875rem 0.5rem;
    letter-spacing: 0.02em;
    text-transform: uppercase;
    border-radius: 0.125rem;
    transition: all 0.15s ease-in-out;

    &:hover {
      transform: translateY(-1px);
    }
  }

  // Header cell refinements
  .ag-header-cell-label {
    font-weight: 600;
    letter-spacing: 0.03em;
    text-transform: uppercase;
    font-size: 0.6875rem;
  }

  // Cell typography
  .ag-cell {
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.01em;
  }

  // Numeric columns - right-aligned with monospace
  .ag-cell.ag-right-aligned-cell {
    font-feature-settings: 'tnum' 1;
  }

  // Row hover enhancement
  .ag-row-hover {
    transition: background-color 0.1s ease-in-out;
  }

  // Loading overlay styling
  .ag-overlay-loading-wrapper {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
  }

  // No rows overlay
  .ag-overlay-no-rows-wrapper {
    color: var(--bs-secondary-color);
  }

  // Scrollbar refinements for webkit browsers
  .ag-body-viewport::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .ag-body-viewport::-webkit-scrollbar-track {
    background: var(--bs-tertiary-bg);
    border-radius: 4px;
  }

  .ag-body-viewport::-webkit-scrollbar-thumb {
    background: var(--bs-secondary-color);
    border-radius: 4px;

    &:hover {
      background: var(--bs-body-color);
    }
  }

  // Sort indicator refinement
  .ag-sort-indicator-icon {
    opacity: 0.8;
  }

  // Column resize handle
  .ag-header-cell-resize {
    opacity: 0;
    transition: opacity 0.15s ease-in-out;
  }

  .ag-header-cell:hover .ag-header-cell-resize {
    opacity: 1;
  }
}

// Dark mode specific enhancements
[data-bs-theme="dark"] :host ::ng-deep {
  // Subtle amber glow on header
  .ag-header {
    border-bottom: 1px solid var(--amber-30);
  }

  // Selected row amber accent
  .ag-row-selected {
    border-left: 2px solid #FFA028;
  }

  // Loading spinner color
  .ag-overlay-loading-center {
    color: #FFA028;
  }
}

// Light mode specific enhancements
[data-bs-theme="light"] :host ::ng-deep {
  // Warm border on header
  .ag-header {
    border-bottom: 1px solid #CFC3B1;
  }

  // Selected row amber accent
  .ag-row-selected {
    border-left: 2px solid #B45309;
  }
}

// ============================================================
// GRID STATUS BAR — Bloomberg Terminal Ticker Style
// ============================================================

@keyframes pulse-fetch {
  0%, 100% {
    opacity: 1;
    box-shadow: 0 0 4px var(--status-loading-color, #0068ff);
  }
  50% {
    opacity: 0.5;
    box-shadow: 0 0 8px var(--status-loading-color, #0068ff);
  }
}

@keyframes slide-in-status {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.grid-status-bar {
  --status-bg: var(--bs-tertiary-bg);
  --status-border: var(--bs-border-color);
  --status-text: var(--bs-secondary-color);
  --status-text-muted: var(--bs-tertiary-color);
  --status-accent: var(--accent-amber, #FFA028);
  --status-ready-color: var(--accent-teal, #4af6c3);
  --status-loading-color: var(--accent-blue, #0068ff);

  display: flex;
  align-items: center;
  gap: 0;
  padding: 0.5rem 0.75rem;
  background: var(--status-bg);
  border-top: 1px solid var(--status-border);
  font-family: 'IBM Plex Mono', 'SF Mono', Consolas, monospace;
  font-size: 0.6875rem;
  letter-spacing: 0.03em;
  animation: slide-in-status 0.25s ease-out;
  position: relative;

  // Subtle grid pattern
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(90deg, var(--status-border) 1px, transparent 1px);
    background-size: 60px 100%;
    opacity: 0.03;
    pointer-events: none;
  }
}

.status-bar__section {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0 0.75rem;
  position: relative;
  z-index: 1;
}

.status-bar__label {
  color: var(--status-text-muted);
  font-weight: 500;
  font-size: 0.625rem;
  text-transform: uppercase;
}

.status-bar__value {
  color: var(--status-text);
  font-weight: 600;
  font-variant-numeric: tabular-nums;
  min-width: 3ch;

  &--primary {
    color: var(--status-accent);
    font-weight: 700;
    font-size: 0.75rem;
  }
}

.status-bar__percentage {
  color: var(--status-text-muted);
  font-size: 0.5625rem;
  padding: 0.125rem 0.25rem;
  background: rgba(128, 128, 128, 0.15);
  border-radius: 2px;
  margin-left: 0.25rem;
}

.status-bar__divider {
  width: 1px;
  height: 1rem;
  background: var(--status-border);
  opacity: 0.5;
}

.status-bar__spacer {
  flex: 1;
}

.status-bar__indicator {
  width: 6px;
  height: 6px;
  border-radius: 1px;
  flex-shrink: 0;

  &--ready {
    background: var(--status-ready-color);
    box-shadow: 0 0 6px var(--status-ready-color);
  }

  &--loading {
    background: var(--status-loading-color);
    animation: pulse-fetch 1s ease-in-out infinite;
  }
}

// Dark mode enhancements
[data-bs-theme="dark"] {
  .grid-status-bar {
    --status-bg: rgba(10, 10, 10, 0.95);
    --status-border: var(--amber-20);
    background: var(--status-bg);
    backdrop-filter: blur(4px);

    // Amber accent line at top
    border-top: 1px solid var(--status-border);
    box-shadow: inset 0 1px 0 var(--amber-10);
  }

  .status-bar__percentage {
    background: var(--amber-10);
    color: var(--status-accent);
  }
}

// Light mode adjustments
[data-bs-theme="light"] {
  .grid-status-bar {
    --status-bg: #FAF7F2;
    --status-border: #CFC3B1;
    --status-accent: #B45309;
    --status-ready-color: #059669;
    --status-loading-color: #0369A1;
    box-shadow: inset 0 1px 0 rgba(180, 83, 9, 0.1);
  }

  .status-bar__percentage {
    background: rgba(180, 83, 9, 0.08);
    color: var(--status-accent);
  }

  .status-bar__indicator--ready {
    box-shadow: 0 0 4px var(--status-ready-color);
  }
}

// Responsive adjustments
@media (max-width: 640px) {
  .grid-status-bar {
    flex-wrap: wrap;
    gap: 0.375rem;
    padding: 0.375rem 0.5rem;
  }

  .status-bar__section {
    padding: 0 0.375rem;
  }

  .status-bar__divider {
    display: none;
  }

  .status-bar__spacer {
    flex-basis: 100%;
    height: 0;
  }

  .status-bar__loaded .status-bar__progress {
    display: none;
  }
}

// ============================================================
// ROW ACTION BUTTONS — Compact Icon Toolbar
// ============================================================

:host ::ng-deep {
  .row-actions {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    height: 100%;
    padding: 0 0.25rem;
  }

  .row-action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    padding: 0;
    border: 1px solid transparent;
    border-radius: 3px;
    background: transparent;
    color: var(--bs-secondary-color);
    font-size: 0.8125rem;
    cursor: pointer;
    transition: all 0.15s ease-out;
    opacity: 0.7;

    &:hover {
      opacity: 1;
      transform: translateY(-1px);
    }

    &:active {
      transform: translateY(0);
    }

    // Edit - Primary action
    &--edit {
      color: var(--accent-blue, #0068ff);

      &:hover {
        background: rgba(0, 104, 255, 0.15);
        border-color: rgba(0, 104, 255, 0.3);
        color: var(--accent-blue, #0068ff);
      }
    }

    // Cancel - Destructive action
    &--cancel {
      color: var(--bs-danger, #dc3545);

      &:hover {
        background: rgba(220, 53, 69, 0.15);
        border-color: rgba(220, 53, 69, 0.3);
        color: var(--bs-danger, #dc3545);
      }
    }

    // Export - Neutral action
    &--export {
      color: var(--accent-teal, #4af6c3);

      &:hover {
        background: rgba(74, 246, 195, 0.15);
        border-color: rgba(74, 246, 195, 0.3);
        color: var(--accent-teal, #4af6c3);
      }
    }

    // Rollback - Warning action
    &--rollback {
      color: var(--accent-amber, #FFA028);

      &:hover {
        background: var(--amber-15);
        border-color: var(--amber-30);
        color: var(--accent-amber, #FFA028);
      }
    }
  }

  // Show actions on row hover (optional - currently always visible)
  // .ag-row:not(:hover) .row-actions {
  //   opacity: 0.4;
  // }
}

// Light mode adjustments for row actions
[data-bs-theme="light"] :host ::ng-deep {
  .row-action-btn {
    opacity: 0.6;

    &--edit {
      color: #0369A1;

      &:hover {
        background: rgba(3, 105, 161, 0.1);
        border-color: rgba(3, 105, 161, 0.2);
      }
    }

    &--cancel {
      color: #B91C1C;

      &:hover {
        background: rgba(185, 28, 28, 0.1);
        border-color: rgba(185, 28, 28, 0.2);
      }
    }

    &--export {
      color: #059669;

      &:hover {
        background: rgba(5, 150, 105, 0.1);
        border-color: rgba(5, 150, 105, 0.2);
      }
    }

    &--rollback {
      color: #B45309;

      &:hover {
        background: rgba(180, 83, 9, 0.1);
        border-color: rgba(180, 83, 9, 0.2);
      }
    }
  }
}

// ============================================================
// FLOATING BULK ACTION BAR — Terminal Command Strip
// ============================================================

@keyframes slide-up-bar {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(100%);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

@keyframes pulse-selection {
  0%, 100% {
    box-shadow: 0 0 0 0 var(--amber-40);
  }
  50% {
    box-shadow: 0 0 0 4px transparent;
  }
}

.bulk-action-bar {
  --bar-bg: rgba(20, 20, 20, 0.97);
  --bar-border: var(--amber-40);
  --bar-text: #FFFFFF;
  --bar-text-muted: rgba(255, 255, 255, 0.6);
  --bar-accent: var(--accent-amber, #FFA028);

  position: fixed;
  bottom: 1.5rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1050;

  display: flex;
  align-items: center;
  gap: 0;
  min-width: 480px;
  max-width: 90vw;
  padding: 0.625rem 0.75rem;

  background: var(--bar-bg);
  border: 1px solid var(--bar-border);
  border-radius: 8px;
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.4),
    0 0 0 1px var(--amber-10),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px);

  font-family: 'IBM Plex Mono', 'SF Mono', Consolas, monospace;
  animation: slide-up-bar 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

.bulk-action-bar__selection {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0 0.75rem;
}

.bulk-action-bar__indicator {
  width: 8px;
  height: 8px;
  background: var(--bar-accent);
  border-radius: 2px;
  animation: pulse-selection 2s ease-in-out infinite;
}

.bulk-action-bar__count {
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--bar-accent);
  font-variant-numeric: tabular-nums;
  min-width: 2ch;
  text-align: right;
}

.bulk-action-bar__label {
  font-size: 0.625rem;
  font-weight: 600;
  color: var(--bar-text-muted);
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.bulk-action-bar__divider {
  width: 1px;
  height: 28px;
  background: var(--bar-border);
  margin: 0 0.25rem;
}

.bulk-action-bar__actions {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0 0.5rem;
}

.bulk-action-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.375rem 0.75rem;
  border: 1px solid transparent;
  border-radius: 4px;
  background: rgba(255, 255, 255, 0.08);
  color: var(--bar-text);
  font-family: inherit;
  font-size: 0.6875rem;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s ease-out;

  i {
    font-size: 0.875rem;
  }

  &:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-1px);
  }

  &:active {
    transform: translateY(0);
  }

  // Edit button
  &--edit {
    &:hover {
      background: rgba(0, 104, 255, 0.2);
      border-color: rgba(0, 104, 255, 0.4);
      color: #60A5FA;
    }
  }

  // Cancel button
  &--cancel {
    &:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.4);
      color: #F87171;
    }
  }

  // Export button
  &--export {
    &:hover {
      background: rgba(74, 246, 195, 0.15);
      border-color: rgba(74, 246, 195, 0.3);
      color: #4AF6C3;
    }
  }
}

.bulk-action-bar__spacer {
  flex: 1;
  min-width: 1rem;
}

.bulk-action-bar__close {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid transparent;
  border-radius: 4px;
  background: transparent;
  color: var(--bar-text-muted);
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.15s ease-out;

  &:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--bar-text);
    border-color: rgba(255, 255, 255, 0.2);
  }
}

// Light mode bulk action bar
[data-bs-theme="light"] {
  .bulk-action-bar {
    --bar-bg: rgba(250, 247, 242, 0.97);
    --bar-border: #CFC3B1;
    --bar-text: #2C1810;
    --bar-text-muted: #7A6B5A;
    --bar-accent: #B45309;

    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.15),
      0 0 0 1px rgba(180, 83, 9, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
  }

  .bulk-action-btn {
    background: rgba(0, 0, 0, 0.05);
    color: var(--bar-text);

    &:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    &--edit:hover {
      background: rgba(3, 105, 161, 0.15);
      border-color: rgba(3, 105, 161, 0.3);
      color: #0369A1;
    }

    &--cancel:hover {
      background: rgba(185, 28, 28, 0.15);
      border-color: rgba(185, 28, 28, 0.3);
      color: #B91C1C;
    }

    &--export:hover {
      background: rgba(5, 150, 105, 0.15);
      border-color: rgba(5, 150, 105, 0.3);
      color: #059669;
    }
  }

  .bulk-action-bar__close {
    &:hover {
      background: rgba(0, 0, 0, 0.08);
      border-color: rgba(0, 0, 0, 0.1);
    }
  }

  .bulk-action-bar__indicator {
    animation-name: pulse-selection-light;
  }

  @keyframes pulse-selection-light {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(180, 83, 9, 0.4);
    }
    50% {
      box-shadow: 0 0 0 4px rgba(180, 83, 9, 0);
    }
  }
}

// Responsive bulk action bar
@media (max-width: 640px) {
  .bulk-action-bar {
    min-width: auto;
    width: calc(100% - 2rem);
    padding: 0.5rem;
    bottom: 1rem;
  }

  .bulk-action-bar__selection {
    padding: 0 0.5rem;
  }

  .bulk-action-btn {
    padding: 0.375rem 0.5rem;

    span {
      display: none;
    }
  }

  .bulk-action-bar__divider {
    height: 24px;
  }
}
