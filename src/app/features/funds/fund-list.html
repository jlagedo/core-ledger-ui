<app-page-header title="Fund Explorer">
  <button type="button" class="btn btn-secondary">
    <i class="bi bi-funnel"></i> Filters
  </button>
  <button type="button" class="btn btn-secondary">
    <i class="bi bi-download"></i> Export
  </button>
  <button type="button" aria-label="Create new fund" class="btn btn-primary" routerLink="/funds/new">
    <i class="bi bi-plus-lg me-1"></i> New Fund
  </button>
</app-page-header>

<main class="container-lg px-3 px-md-4">

  <div class="card bg-body-tertiary border-0 shadow-sm rounded-4 border-top bg-opacity-50">
    <div class="card-body p-3 p-md-4">

      <div class="row align-items-center mb-3 g-3">
        <div class="col-12 col-md-4">
          <div class="input-group">
            <span class="input-group-text bg-body-secondary border-secondary">
              <i class="bi bi-search"></i>
            </span>
            <input #searchInput (keydown.enter)="onSearch(searchInput.value)" [value]="store.searchTerm()"
              aria-label="Search funds by name" class="form-control bg-body border-secondary"
              placeholder="Search funds..." type="text">
          </div>
        </div>

        <div class="col-12 col-md-4 text-center">
          <span class="text-secondary small fw-medium">
            <i class="bi bi-collection me-2"></i>{{ collectionSize() }} total funds
          </span>
        </div>

        <div class="col-12 col-md-4 d-flex justify-content-md-end">
          <label for="pageSizeSelect" class="visually-hidden">Items per page</label>
          <select id="pageSizeSelect" (ngModelChange)="onPageSizeChange($event)" [ngModel]="store.pageSize()"
            class="form-select bg-body border-secondary w-100">
            <option [ngValue]="15">15 items per page</option>
            <option [ngValue]="50">50 items per page</option>
            <option [ngValue]="100">100 items per page</option>
          </select>
        </div>
      </div>

      <!-- Data Table with custom cell and action templates -->
      <app-data-table
        [columns]="columns"
        [items]="funds()"
        [store]="store"
        [collectionSize]="collectionSize()"
        [trackBy]="trackByFundId"
        (reload)="loadFunds()">

        <!-- Custom cell template for special formatting -->
        <ng-template #cellTemplate let-fund let-column="column" let-value="value">
          @if (column.key === 'code') {
            <strong class="numeric">{{ value }}</strong>
          } @else if (column.key === 'inceptionDate') {
            <span class="text-muted">{{ value }}</span>
          } @else {
            {{ value }}
          }
        </ng-template>

        <!-- Custom actions template -->
        <ng-template #actionsTemplate let-fund>
          <div class="btn-group btn-group-sm table-row-actions" role="group" aria-label="Fund actions">
            <button type="button" class="btn btn-secondary" [routerLink]="['/funds', fund.id, 'edit']"
              [attr.aria-label]="'Edit fund ' + fund.name" (click)="$event.stopPropagation()">
              <i class="bi bi-pencil" aria-hidden="true"></i>
            </button>
            <div class="btn-group btn-group-sm" container="body" ngbDropdown role="group">
              <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split"
                ngbDropdownToggle [attr.aria-label]="'More actions for fund ' + fund.name"
                (click)="$event.stopPropagation()">
                <span class="visually-hidden">Toggle Dropdown</span>
              </button>
              <div ngbDropdownMenu>
                <button type="button" [routerLink]="['/funds', fund.id]" ngbDropdownItem>
                  <i class="bi bi-eye me-2"></i>View Details
                </button>
                <hr class="dropdown-divider">
                <button type="button" ngbDropdownItem>
                  <i class="bi bi-toggle-on me-2"></i>Manage Fund Status
                </button>
                <button type="button" ngbDropdownItem>
                  <i class="bi bi-clock-history me-2"></i>Audit Log
                </button>
                <button type="button" ngbDropdownItem>
                  <i class="bi bi-download me-2"></i>Export Fund Information
                </button>
              </div>
            </div>
          </div>
        </ng-template>
      </app-data-table>

    </div>
  </div>
</main>