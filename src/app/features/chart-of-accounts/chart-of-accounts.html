<main class="container-fluid">

  <!-- Card Wrapper -->
  <div class="card shadow-sm">
    <div class="card-body">

      <!-- Toolbar -->
      <div class="row g-3 align-items-center mb-3">
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-search"></i>
            </span>
            <input type="text" class="form-control" placeholder="Search accounts..." #searchInput [value]="store.searchTerm()"
              (keydown.enter)="onSearch(searchInput.value)" aria-label="Search accounts by description">
          </div>
        </div>

        <div class="col-md-8 text-end">
          <div class="btn-group">
            <button class="btn btn-outline-secondary">
              <i class="bi bi-funnel"></i> Filters
            </button>
            <button class="btn btn-outline-secondary">
              <i class="bi bi-download"></i> Export
            </button>
            <button class="btn btn-primary" routerLink="/chart-of-accounts/new" aria-label="Create new account">
              <i class="bi bi-plus-lg me-1"></i> New Account
            </button>
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table table-hover table-striped table-sm table-bordered">
          <thead>
            <tr>
              <th scope="col" class="text-end" sortable="code" (sort)="onSort($event)">#</th>
              <th scope="col" class="text-start" sortable="name" (sort)="onSort($event)">Name</th>
              <th scope="col" class="text-center" sortable="typeid" (sort)="onSort($event)">Type</th>
              <th scope="col" class="text-center" sortable="status" (sort)="onSort($event)">Status</th>
              <th scope="col" class="text-center" sortable="normalbalance" (sort)="onSort($event)">Normal Balance</th>
              <th scope="col" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody class="table-group-divider">
            @defer (on immediate) {
            @for (account of accountsResponse()?.items; track account.id) {
            <tr>
              <td class="text-end">{{ account.code }}</td>
              <td class="text-start">{{ account.name }}</td>
              <td class="text-center">{{ account.typeDescription }}</td>
              <td class="text-center">{{ account.statusDescription }}</td>
              <td class="text-center">{{ account.normalBalanceDescription }}</td>
              <td class="text-center">

                <div ngbDropdown class="d-inline-block" container="body">
                  <button class="btn btn-sm" ngbDropdownToggle>
                    <i class="bi bi-three-dots-vertical"></i>
                  </button>

                  <div ngbDropdownMenu>
                    <button ngbDropdownItem>View</button>
                    <button ngbDropdownItem>Edit</button>
                    <button ngbDropdownItem
                            (click)="openDeactivateModal(account)"
                            class="text-danger">Deactivate</button>
                  </div>
                </div>

              </td>
            </tr>
            }
            } @loading {
            <tr>
              <td colspan="6" class="text-center py-5">
                <div class="spinner-border text-primary" role="status"></div>
                <div class="mt-2 text-muted">Loading accountsâ€¦</div>
              </td>
            </tr>
            } @error {
            <tr>
              <td colspan="6" class="text-center text-danger py-5">
                Failed to load accounts.
              </td>
            </tr>
            }

          </tbody>
        </table>

        <div class="d-flex justify-content-between p-2">

          <ngb-pagination [collectionSize]="collectionSize()" [page]="store.page()" [pageSize]="store.pageSize()"
            (pageChange)="store.setPage($event); loadAccounts()" [maxSize]="5" [rotate]="true" [boundaryLinks]="true">
          </ngb-pagination>
          <span class="d-flex align-items-center text-muted">
            {{ collectionSize() }} total accounts
          </span>

          <select class="form-select page-size-select" [ngModel]="store.pageSize()"
            (ngModelChange)="onPageSizeChange($event)">
            <option [ngValue]="15">15 items per page</option>
            <option [ngValue]="50">50 items per page</option>
            <option [ngValue]="100">100 items per page</option>
          </select>
        </div>


      </div>

    </div>
  </div>
</main>
